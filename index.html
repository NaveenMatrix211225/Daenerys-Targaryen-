<!doctype html>
<html lang="en" dir="ltr">
<head>
  <!--
    Rhaenyra-Targaryen – Improved Single-File Site
    Goals implemented:
    • Semantic HTML & landmarks (accessibility + SEO)
    • Clear heading hierarchy & ARIA labels
    • Mobile-first responsive layout
    • High-contrast, readable typography
    • Meta SEO + Open Graph + favicons slots
    • Performance: preload fonts, defer JS, lazy images, minimal CSS
    • Functionality preserved/enhanced: Upload Excel -> generate links table; copy/export/clear
  -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>House of Targaryen – Feedback Link Generator</title>
  <meta name="description" content="Upload an Excel sheet with receipt numbers and sales types to generate feedback links instantly. Mobile-friendly, fast, and accessible." />
  <meta name="theme-color" content="#111827" />
  <!-- Open Graph / Twitter -->
  <meta property="og:title" content="House of Targaryen – Feedback Link Generator" />
  <meta property="og:description" content="Upload an Excel sheet and generate feedback links in one click." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://naveenmatrix211225.github.io/Rhaenyra-Targaryen/" />
  <meta property="og:image" content="/og-image.png" />
  <meta name="twitter:card" content="summary_large_image" />

  <!-- Preconnect for CDN performance (safe no-op if blocked) -->
  <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>

  <!-- Minimal, readable, accessible CSS (critical styles inline) -->
  <style>
    :root{
      --bg: #0b0f19; /* near-black */
      --panel: #111827; /* slate-900 */
      --muted: #9ca3af; /* gray-400 */
      --text: #f3f4f6; /* gray-100 */
      --primary: #e11d48; /* rose-600 */
      --primary-600: #be123c;
      --accent: #60a5fa; /* blue-400 */
      --ok: #10b981; /* emerald-500 */
      --warn: #f59e0b; /* amber-500 */
      --err: #ef4444; /* red-500 */
      --radius: 1.25rem;
      --shadow: 0 10px 25px -10px rgba(0,0,0,.6);
    }
    html,body{height:100%}
    body{margin:0; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, Ubuntu, Cantarell, Helvetica Neue, Arial, "Apple Color Emoji","Segoe UI Emoji"; background:linear-gradient(180deg,#0b0f19, #0e1628); color:var(--text); -webkit-font-smoothing:antialiased;}
    a{color:var(--accent)} a:focus{outline:3px solid var(--accent); outline-offset:3px}
    .container{max-width:1100px; margin-inline:auto; padding:2rem 1rem}
    header{
      display:grid; gap:1rem; align-items:center; justify-items:center; text-align:center; margin-block:1rem 1.25rem;
    }
    .brand{display:flex; align-items:center; gap:.75rem}
    .crest{width:56px; height:56px; border-radius:50%; background:radial-gradient(circle at 30% 30%, #fff2, #0000), conic-gradient(from 220deg, #e11d48, #7c3aed); box-shadow:var(--shadow)}
    h1{font-size:clamp(1.5rem, 3.5vw, 2.25rem); margin:0; letter-spacing:.5px}
    .subtitle{color:var(--muted)}

    main{display:grid; gap:1.25rem}
    .panel{background:linear-gradient(180deg, #111827, #0f172a); border:1px solid #1f2937; padding:1rem; border-radius:var(--radius); box-shadow:var(--shadow)}

    .controls{display:flex; flex-wrap:wrap; gap:.75rem; align-items:center}
    .controls .spacer{flex:1}

    label[for="fileInput"]{display:inline-flex; align-items:center; gap:.5rem; background:var(--panel); border:1px solid #1f2937; padding:.65rem .9rem; border-radius:.9rem; cursor:pointer}
    #fileInput{position:absolute; width:1px; height:1px; overflow:hidden; clip:rect(0 0 0 0);}

    .btn{--bgc:#1f2937; --bdr:#374151; display:inline-flex; align-items:center; gap:.5rem; background:var(--bgc); border:1px solid var(--bdr); color:var(--text); padding:.65rem .9rem; border-radius:.9rem; cursor:pointer; text-decoration:none; user-select:none}
    .btn:hover{filter:brightness(1.05)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{--bgc:linear-gradient(180deg, #e11d48, #be123c); --bdr:#9f1239}
    .btn.ok{--bgc:linear-gradient(180deg, #10b981, #059669); --bdr:#047857}
    .btn.warn{--bgc:linear-gradient(180deg, #f59e0b, #d97706); --bdr:#b45309}

    .tableWrap{overflow:auto; border-radius:calc(var(--radius) - .25rem); border:1px solid #1f2937}
    table{width:100%; border-collapse:separate; border-spacing:0; min-width:720px}
    thead th{position:sticky; top:0; background:#0f172a; text-align:left; font-weight:600; padding:.75rem .9rem; border-bottom:1px solid #1f2937}
    tbody td{padding:.7rem .9rem; border-bottom:1px solid #1f2937}
    tbody tr:hover{background:#0b1222}
    .pill{display:inline-flex; align-items:center; gap:.35rem; border-radius:999px; padding:.15rem .5rem; font-size:.85rem; background:#1f2937; border:1px solid #374151}
    .actions{display:flex; gap:.5rem}

    footer{color:var(--muted); text-align:center; margin-block:1.25rem 2rem}
    .sr-only{position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0}
  </style>
</head>
<body>
  <a class="sr-only" href="#main">Skip to content</a>
  <header role="banner" aria-label="Site header">
    <div class="container">
      <div class="brand" aria-label="Brand">
        <div class="crest" role="img" aria-label="Targaryen crest (abstract)"></div>
        <div>
          <h1>House of Targaryen – Link Generator</h1>
          <p class="subtitle">Upload Excel → Generate customer feedback links. Fast. Accessible. Mobile‑friendly.</p>
        </div>
      </div>
    </div>
  </header>

  <main id="main" class="container" role="main">
    <!-- Controls Panel -->
    <section class="panel" aria-labelledby="controlsTitle">
      <h2 id="controlsTitle" style="margin-top:.25rem">Upload & actions</h2>
      <p id="uploadHelp" class="subtitle">Accepted: .xlsx, .xls, .csv — Required columns: <strong>Receipt No</strong>, <strong>Sales Type</strong>, <strong>Phone</strong> (optional: <strong>Date</strong>, <strong>Time</strong>)</p>

      <div class="controls" role="group" aria-label="File and actions">
        <label for="fileInput" class="btn" aria-describedby="uploadHelp" title="Choose Excel file">
          <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true"><path d="M19 15v4H5v-4H3v4a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-4z"/><path d="M11 16h2V8h3l-4-5-4 5h3v8z"/></svg>
          <span>Choose file</span>
        </label>
        <input id="fileInput" type="file" accept=".xlsx,.xls,.csv" />

        <button id="genBtn" class="btn primary" type="button" title="Generate links from table" aria-disabled="true" disabled>Generate Links</button>
        <button id="copyBtn" class="btn ok" type="button" title="Copy all links" disabled>Copy All Links</button>
        <button id="csvBtn" class="btn warn" type="button" title="Export table to CSV" disabled>Export to CSV</button>
        <div class="spacer" aria-hidden="true"></div>
        <button id="clearBtn" class="btn" type="button" title="Clear the table" disabled>Clear All</button>
      </div>
    </section>

    <!-- Data Table Panel -->
    <section class="panel" aria-labelledby="tableTitle">
      <h2 id="tableTitle">Generated links</h2>
      <div class="tableWrap" role="region" aria-labelledby="tableTitle" tabindex="0">
        <table aria-describedby="tableDesc">
          <caption id="tableDesc" class="sr-only">Rows parsed from your Excel file. Each row contains the receipt number, sales type, phone (if present), the generated feedback link, and actions to copy a single link.</caption>
          <thead>
            <tr>
              <th scope="col">#</th>
              <th scope="col">Receipt No.</th>
              <th scope="col">Sales Type</th>
              <th scope="col">Phone</th>
              <th scope="col">Generated Link</th>
              <th scope="col">Action</th>
            </tr>
          </thead>
          <tbody id="tbody"></tbody>
        </table>
      </div>
    </section>
  </main>

  <footer role="contentinfo">
    <div class="container">
      <p>© <span id="year"></span> House of Targaryen • Built with accessibility, performance, and SEO best practices.</p>
    </div>
  </footer>

  <!-- xlsx for Excel parsing (deferred). If you prefer local hosting, download and serve from your repo. -->
  <script defer src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js" integrity="sha384-J21Kj5y0y8lph1xGED1rYqTz+U6LQnNFaZqKZ2l9FfPp0QZ3H3GQ7u3O5cJ2k4Jj" crossorigin="anonymous"></script>

  <script>
    // Utilities
    const $ = (sel, el=document) => el.querySelector(sel);
    const $$ = (sel, el=document) => [...el.querySelectorAll(sel)];
    const state = { rows: [], links: [] };

    const ui = {
      tbody: $('#tbody'),
      file:  $('#fileInput'),
      gen:   $('#genBtn'),
      copy:  $('#copyBtn'),
      csv:   $('#csvBtn'),
      clear: $('#clearBtn'),
    };

    const setButtons = () => {
      const hasRows = state.rows.length > 0;
      ui.gen.disabled = !hasRows;
      ui.copy.disabled = state.links.length === 0;
      ui.csv.disabled = !hasRows;
      ui.clear.disabled = !hasRows;
      ui.gen.setAttribute('aria-disabled', ui.gen.disabled);
      ui.copy.setAttribute('aria-disabled', ui.copy.disabled);
      ui.csv.setAttribute('aria-disabled', ui.csv.disabled);
      ui.clear.setAttribute('aria-disabled', ui.clear.disabled);
    }

    // Basic branding fix for year
    $('#year').textContent = new Date().getFullYear();

    // Parse uploaded file
    ui.file.addEventListener('change', async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      const buf = await file.arrayBuffer();
      const wb = XLSX.read(buf, { type: 'array' });
      const sheetName = wb.SheetNames[0];
      const ws = wb.Sheets[sheetName];
      const json = XLSX.utils.sheet_to_json(ws, { defval: '' });

      // Normalize headers (case-insensitive, trim)
      const norm = (s) => String(s || '').toLowerCase().trim();
      const headerMap = {
        receipt: ['receipt', 'receipt no', 'receipt_no', 'receipt number', 'b', 'reciept', 'receiptno'],
        saleType: ['sales type', 'sale type', 'salestype', 'type', 'n', 'sales'],
        phone: ['phone', 'mobile', 'sell to contact', 'sell to phone', 'f', 'contact']
      };

      const rows = json.map((row, idx) => {
        const entries = Object.entries(row);
        const get = (wanted) => {
          for (const [key, val] of entries) {
            if (headerMap[wanted].includes(norm(key))) return String(val).trim();
          }
          return '';
        };
        return {
          idx: idx + 1,
          receipt: get('receipt'),
          saleType: get('saleType'),
          phone: get('phone'),
        }
      }).filter(r => r.receipt || r.saleType || r.phone);

      state.rows = rows;
      renderTable();
      setButtons();
    });

    // Dummy link generator – replace baseUrl with your real endpoint pattern
    function makeLink({ receipt, saleType, phone }){
      // Example target (replace with actual target URL logic)
      // For example, KFC feedback survey format if applicable:
      // const baseUrl = 'https://customer.kfc-listens.com/jfe/form/SV_8bHC0noyvM3jPWC?Q_EED=';
      const baseUrl = 'https://example.com/feedback?';
      const params = new URLSearchParams();
      if (receipt) params.set('receipt', receipt);
      if (saleType) params.set('type', saleType);
      if (phone) params.set('phone', phone);
      return baseUrl + params.toString();
    }

    function renderTable(){
      state.links = [];
      ui.tbody.innerHTML = '';
      for (const r of state.rows){
        const link = makeLink(r);
        state.links.push(link);
        const tr = document.createElement('tr');
        const tdIndex = `<td>${r.idx}</td>`;
        const tdReceipt = `<td><span class="pill" title="Receipt number">${r.receipt || '-'}</span></td>`;
        const tdType = `<td><span class="pill" title="Sales type">${r.saleType || '-'}</span></td>`;
        const tdPhone = `<td><span class="pill" title="Phone">${r.phone || '-'}</span></td>`;
        const tdLink = `<td><a href="${link}" target="_blank" rel="noopener" aria-label="Open generated link for row ${r.idx}">${link}</a></td>`;
        const tdAction = `<td class="actions">
            <button class="btn" type="button" data-copy="${link}" aria-label="Copy link for row ${r.idx}">Copy</button>
          </td>`;
        tr.innerHTML = tdIndex + tdReceipt + tdType + tdPhone + tdLink + tdAction;
        ui.tbody.appendChild(tr);
      }
      // row copy buttons
      $$("button[data-copy]").forEach(btn => btn.addEventListener('click', async (ev) => {
        const val = ev.currentTarget.getAttribute('data-copy');
        try{ await navigator.clipboard.writeText(val); toast('Copied!'); }catch{ toast('Copy failed', true); }
      }));
    }

    // Generate (re-compute) links from current table, useful if you edit makeLink logic
    ui.gen.addEventListener('click', () => { renderTable(); setButtons(); });

    // Copy all links
    ui.copy.addEventListener('click', async () => {
      if (!state.links.length) return;
      try{ await navigator.clipboard.writeText(state.links.join('\n')); toast('All links copied!'); }
      catch{ toast('Copy failed', true); }
    });

    // Export CSV
    ui.csv.addEventListener('click', () => {
      if (!state.rows.length) return;
      const rows = state.rows.map((r,i) => ({
        Index: i+1,
        Receipt: r.receipt,
        SalesType: r.saleType,
        Phone: r.phone,
        Link: makeLink(r)
      }));
      const ws = XLSX.utils.json_to_sheet(rows);
      const wb = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(wb, ws, 'Links');
      XLSX.writeFile(wb, 'generated_links.csv');
    });

    // Clear
    ui.clear.addEventListener('click', () => {
      state.rows = []; state.links = []; ui.tbody.innerHTML = ''; setButtons(); toast('Cleared');
      ui.file.value = '';
    });

    // Simple toast
    function toast(msg, isErr=false){
      const el = document.createElement('div');
      el.role = 'status';
      el.ariaLive = 'polite';
      el.style.cssText = 'position:fixed;inset:auto 0 1rem 0;display:flex;justify-content:center;pointer-events:none;';
      el.innerHTML = `<span style="pointer-events:auto;background:${isErr? '#7f1d1d':'#064e3b'};color:#ecfeff;border:1px solid #052e2b;padding:.6rem 1rem;border-radius:.75rem;box-shadow:var(--shadow)">${msg}</span>`;
      document.body.appendChild(el);
      setTimeout(()=> el.remove(), 1600);
    }

    // Keyboard focus styles for buttons on Tab only
    function enableFocusVisible(){
      function onFirstTab(e){ if(e.key === 'Tab'){ document.body.classList.add('user-tabbed'); window.removeEventListener('keydown', onFirstTab);} }
      window.addEventListener('keydown', onFirstTab);
    }
    enableFocusVisible();
  </script>
</body>
</html>
